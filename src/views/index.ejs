<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chaos Ops Console</title>

  <style>
    :root {
      --bg: #040605;
      --panel: #070b08;
      --panel2: #060807;
      --grid: rgba(68, 255, 120, 0.08);
      --txt: rgba(190, 255, 214, 0.92);
      --muted: rgba(190, 255, 214, 0.62);

      --ok: rgba(68, 255, 120, 0.26);
      --warn: rgba(255, 216, 84, 0.22);
      --bad: rgba(255, 70, 90, 0.22);

      --okB: rgba(68, 255, 120, 0.45);
      --warnB: rgba(255, 216, 84, 0.45);
      --badB: rgba(255, 70, 90, 0.45);

      --shadow: 0 0 0 1px rgba(68, 255, 120, 0.12), 0 20px 50px rgba(0, 0, 0, 0.45);
      --shadow2: 0 0 0 1px rgba(68, 255, 120, 0.10), 0 10px 25px rgba(0, 0, 0, 0.55);

      --radius: 18px;
      --radius2: 14px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(68, 255, 120, 0.10), transparent 55%),
        radial-gradient(1200px 800px at 80% 30%, rgba(255, 216, 84, 0.08), transparent 60%),
        radial-gradient(1200px 800px at 60% 85%, rgba(255, 70, 90, 0.06), transparent 55%),
        var(--bg);
      color: var(--txt);
      margin: 0;
      font-family: var(--mono);
    }

    .noise {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.08;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    .grid {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        linear-gradient(to right, var(--grid) 1px, transparent 1px) 0 0 / 48px 48px,
        linear-gradient(to bottom, var(--grid) 1px, transparent 1px) 0 0 / 48px 48px;
      opacity: 0.35;
      mask-image: radial-gradient(circle at 50% 20%, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0) 70%);
    }

    .wrap {
      max-width: 1080px;
      margin: 0 auto;
      padding: 28px 18px 80px;
    }

    .topbar {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .brand h1 {
      font-size: 18px;
      margin: 0;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .brand .sub {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(68, 255, 120, 0.18);
      background: rgba(0, 0, 0, 0.20);
      box-shadow: var(--shadow2);
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(68, 255, 120, 0.9);
      box-shadow: 0 0 14px rgba(68, 255, 120, 0.7);
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-end;
    }

    /* Botão discreto do manual */
    .manualBtn {
      border: 1px solid rgba(190, 255, 214, 0.18);
      background: rgba(0, 0, 0, 0.22);
      color: rgba(190, 255, 214, 0.72);
      padding: 8px 10px;
      border-radius: 999px;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .08s ease, border-color .12s ease, background .12s ease, color .12s ease;
    }

    .manualBtn:hover {
      border-color: rgba(190, 255, 214, 0.35);
      background: rgba(0, 0, 0, 0.35);
      color: rgba(190, 255, 214, 0.92);
    }

    .manualBtn:active {
      transform: translateY(1px);
    }

    .manualBtn kbd {
      margin-left: 6px;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(190, 255, 214, 0.18);
      background: rgba(0, 0, 0, 0.30);
      color: rgba(190, 255, 214, 0.70);
      letter-spacing: 0.06em;
    }

    .twoCol {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 16px;
    }

    @media (max-width: 960px) {
      .twoCol {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(68, 255, 120, 0.07), rgba(0, 0, 0, 0.18));
      border: 1px solid rgba(68, 255, 120, 0.16);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .panelHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(68, 255, 120, 0.12);
      background: rgba(0, 0, 0, 0.24);
    }

    .panelHeader h2 {
      margin: 0;
      font-size: 12px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: rgba(190, 255, 214, 0.82);
    }

    .panelBody {
      padding: 16px;
      background: rgba(0, 0, 0, 0.10);
    }

    .btnGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 700px) {
      .btnGrid {
        grid-template-columns: 1fr;
      }
    }

    .hackBtn {
      border-radius: var(--radius2);
      border: 1px solid rgba(68, 255, 120, 0.22);
      background: radial-gradient(600px 250px at 20% 10%, rgba(68, 255, 120, 0.12), transparent 55%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.35));
      padding: 14px 14px 12px;
      text-align: left;
      cursor: pointer;
      transition: transform .08s ease, border-color .14s ease, box-shadow .14s ease, filter .14s ease;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.35), 0 16px 35px rgba(0, 0, 0, 0.42);
      color: var(--txt);
      position: relative;
      overflow: hidden;
      min-height: 82px;
    }

    .hackBtn:hover {
      border-color: rgba(68, 255, 120, 0.45);
      box-shadow: 0 0 0 1px rgba(68, 255, 120, 0.18), 0 18px 45px rgba(0, 0, 0, 0.55);
      filter: brightness(1.05);
    }

    .hackBtn:active {
      transform: translateY(1px);
    }

    .hackBtn small {
      display: block;
      color: rgba(190, 255, 214, 0.62);
      letter-spacing: 0.10em;
      font-size: 12px;
      text-transform: lowercase;
    }

    .hackBtn strong {
      display: block;
      margin-top: 6px;
      font-size: 17px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .hackBtn .tag {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(190, 255, 214, 0.18);
      color: rgba(190, 255, 214, 0.72);
      background: rgba(0, 0, 0, 0.25);
    }

    .hackBtn.warn {
      border-color: rgba(255, 216, 84, 0.22);
      background: radial-gradient(600px 250px at 20% 10%, rgba(255, 216, 84, 0.14), transparent 55%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.35));
    }

    .hackBtn.warn:hover {
      border-color: rgba(255, 216, 84, 0.48);
      box-shadow: 0 0 0 1px rgba(255, 216, 84, 0.18), 0 18px 45px rgba(0, 0, 0, 0.55);
    }

    .hackBtn.bad {
      border-color: rgba(255, 70, 90, 0.26);
      background: radial-gradient(600px 250px at 20% 10%, rgba(255, 70, 90, 0.14), transparent 55%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.35));
    }

    .hackBtn.bad:hover {
      border-color: rgba(255, 70, 90, 0.55);
      box-shadow: 0 0 0 1px rgba(255, 70, 90, 0.20), 0 18px 45px rgba(0, 0, 0, 0.60);
    }

    .sectionTitle {
      margin: 0 0 12px 0;
      font-size: 12px;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: rgba(190, 255, 214, 0.65);
    }

    .console {
      border-radius: var(--radius2);
      border: 1px solid rgba(68, 255, 120, 0.18);
      background:
        radial-gradient(800px 400px at 15% 10%, rgba(68, 255, 120, 0.08), transparent 55%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.62), rgba(0, 0, 0, 0.36));
      box-shadow: var(--shadow2);
      padding: 12px 12px 10px;
      overflow: auto;
      height: 360px;
      font-size: 12px;
      line-height: 1.45;
      white-space: pre-wrap;
    }

    .line {
      display: block;
      margin: 0;
      padding: 0;
    }

    .line .t {
      color: rgba(190, 255, 214, 0.55);
    }

    .line.ok {
      color: rgba(190, 255, 214, 0.92);
    }

    .line.warn {
      color: rgba(255, 216, 84, 0.92);
    }

    .line.bad {
      color: rgba(255, 120, 132, 0.92);
    }

    .line.code {
      color: rgba(190, 255, 214, 0.86);
      opacity: 0.92;
    }

    .statusBox {
      display: grid;
      gap: 10px;
    }

    .kv {
      border-radius: var(--radius2);
      border: 1px solid rgba(68, 255, 120, 0.16);
      background: rgba(0, 0, 0, 0.18);
      box-shadow: var(--shadow2);
      padding: 10px 12px;
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 10px;
      align-items: center;
      font-size: 12px;
    }

    .kv b {
      color: rgba(190, 255, 214, 0.70);
      letter-spacing: 0.10em;
      text-transform: uppercase;
      font-size: 11px;
    }

    .kv span {
      color: rgba(190, 255, 214, 0.92);
      overflow-wrap: anywhere;
    }

    .hint {
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.05em;
      line-height: 1.35;
    }

    .footer {
      margin-top: 18px;
      color: rgba(190, 255, 214, 0.55);
      font-size: 11px;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .kbd {
      border: 1px solid rgba(190, 255, 214, 0.16);
      background: rgba(0, 0, 0, 0.22);
      border-radius: 8px;
      padding: 2px 6px;
      font-size: 10px;
      letter-spacing: 0.10em;
      color: rgba(190, 255, 214, 0.66);
    }

    .loading {
      opacity: 0.8;
    }

    /* Modal do Manual */
    .modalBackdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.68);
      backdrop-filter: blur(6px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    .modalBackdrop.open {
      display: flex;
    }

    .modal {
      width: min(980px, 96vw);
      max-height: min(78vh, 820px);
      overflow: hidden;
      border-radius: 18px;
      border: 1px solid rgba(68, 255, 120, 0.20);
      background: radial-gradient(1200px 600px at 20% 10%, rgba(68, 255, 120, 0.10), transparent 55%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.78), rgba(0, 0, 0, 0.50));
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.35), 0 22px 70px rgba(0, 0, 0, 0.70);
    }

    .modalHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(68, 255, 120, 0.12);
      background: rgba(0, 0, 0, 0.30);
    }

    .modalHeader h3 {
      margin: 0;
      font-size: 12px;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: rgba(190, 255, 214, 0.85);
    }

    .modalHeader .right {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(190, 255, 214, 0.55);
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .closeBtn {
      border: 1px solid rgba(190, 255, 214, 0.18);
      background: rgba(0, 0, 0, 0.28);
      color: rgba(190, 255, 214, 0.85);
      padding: 8px 10px;
      border-radius: 12px;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform .08s ease, border-color .12s ease, background .12s ease;
    }

    .closeBtn:hover {
      border-color: rgba(190, 255, 214, 0.35);
      background: rgba(0, 0, 0, 0.40);
    }

    .closeBtn:active {
      transform: translateY(1px);
    }

    .modalBody {
      padding: 14px 16px 16px;
      overflow: auto;
      max-height: calc(min(78vh, 820px) - 54px);
    }

    .helpIntro {
      color: rgba(190, 255, 214, 0.70);
      font-size: 12px;
      line-height: 1.5;
      letter-spacing: 0.03em;
      margin: 0 0 12px 0;
    }

    .helpGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 920px) {
      .helpGrid {
        grid-template-columns: 1fr;
      }
    }

    .helpCard {
      border-radius: 14px;
      border: 1px solid rgba(68, 255, 120, 0.16);
      background: rgba(0, 0, 0, 0.22);
      box-shadow: var(--shadow2);
      padding: 12px 12px 10px;
    }

    .helpCard .row1 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .helpCard .name {
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(190, 255, 214, 0.92);
    }

    .helpCard .risk {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(190, 255, 214, 0.16);
      color: rgba(190, 255, 214, 0.70);
      background: rgba(0, 0, 0, 0.25);
      white-space: nowrap;
    }

    .helpCard .risk.info {
      border-color: rgba(68, 255, 120, 0.22);
      color: rgba(190, 255, 214, 0.78);
    }

    .helpCard .risk.warn {
      border-color: rgba(255, 216, 84, 0.30);
      color: rgba(255, 216, 84, 0.92);
    }

    .helpCard .risk.bad {
      border-color: rgba(255, 70, 90, 0.32);
      color: rgba(255, 120, 132, 0.96);
    }

    .helpCard .endpoint {
      font-size: 12px;
      color: rgba(190, 255, 214, 0.62);
      letter-spacing: 0.08em;
      margin-bottom: 8px;
    }

    .helpCard .desc {
      font-size: 12px;
      line-height: 1.45;
      color: rgba(190, 255, 214, 0.80);
    }

    .helpTips {
      margin-top: 12px;
      color: rgba(190, 255, 214, 0.62);
      font-size: 12px;
      line-height: 1.45;
    }
  </style>
</head>

<body>
  <div class="grid"></div>
  <div class="noise"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>CHAOS OPS CONSOLE</h1>
        <div class="sub">
          <span class="pill"><span class="dot"></span> operacional</span>
          <span class="pill">cluster stress · incident drills</span>
          <span class="pill">modo: <span id="modeText">SAFE</span></span>
        </div>
      </div>

      <div class="actions">
        <button class="manualBtn" id="manualOpenBtn" title="Abrir manual de botões (atalho: ?)">
          MANUAL <span style="opacity:.7">?</span> <kbd>?</kbd>
        </button>
      </div>
    </div>

    <div class="twoCol">
      <div class="panel">
        <div class="panelHeader">
          <h2>Ataques de Consumo</h2>
        </div>
        <div class="panelBody">
          <div class="btnGrid" id="attackGrid">
            <button class="hackBtn" data-endpoint="/attack/cpu" data-name="CPU SURGE">
              <span class="tag">HIGH</span>
              <small>/attack/cpu</small>
              <strong>CPU SURGE</strong>
            </button>

            <button class="hackBtn" data-endpoint="/attack/memory" data-name="RAM FLOOD">
              <span class="tag">HIGH</span>
              <small>/attack/memory</small>
              <strong>RAM FLOOD</strong>
            </button>

            <button class="hackBtn" data-endpoint="/attack/disk" data-name="DISK THRASH">
              <span class="tag">MID</span>
              <small>/attack/disk</small>
              <strong>DISK THRASH</strong>
            </button>

            <button class="hackBtn" data-endpoint="/attack/io" data-name="IO STORM">
              <span class="tag">MID</span>
              <small>/attack/io</small>
              <strong>IO STORM</strong>
            </button>

            <button class="hackBtn" data-endpoint="/attack/fork" data-name="FORK SWARM">
              <span class="tag">RISK</span>
              <small>/attack/fork</small>
              <strong>FORK SWARM</strong>
            </button>

            <button class="hackBtn" data-endpoint="/attack/net" data-name="NETWORK SPIKE">
              <span class="tag">MID</span>
              <small>/attack/net</small>
              <strong>NETWORK SPIKE</strong>
            </button>
          </div>

          <div style="height:16px"></div>

          <h3 class="sectionTitle">Falhas e Controles</h3>
          <div class="btnGrid">
            <button class="hackBtn warn" data-endpoint="/control/unhealth" data-name="MARCAR DOENTE">
              <span class="tag">DRILL</span>
              <small>/control/unhealth</small>
              <strong>MARCAR DOENTE</strong>
            </button>

            <button class="hackBtn" data-endpoint="/control/health" data-name="RECUPERAR HEALTH">
              <span class="tag">OK</span>
              <small>/control/health</small>
              <strong>RECUPERAR HEALTH</strong>
            </button>

            <button class="hackBtn warn" data-endpoint="/control/unreadyfor" data-name="FORÇAR UNREADY">
              <span class="tag">DRILL</span>
              <small>/control/unreadyfor</small>
              <strong>FORÇAR UNREADY</strong>
            </button>

            <button class="hackBtn" data-endpoint="/control/ready" data-name="RECUPERAR READY">
              <span class="tag">OK</span>
              <small>/control/ready</small>
              <strong>RECUPERAR READY</strong>
            </button>
          </div>

          <div style="height:16px"></div>

          <h3 class="sectionTitle">Desligamento</h3>
          <div class="btnGrid">
            <button class="hackBtn bad" data-endpoint="/control/sigterm" data-name="ENVIAR SIGTERM">
              <span class="tag">ALTO RISCO</span>
              <small>/control/sigterm</small>
              <strong>ENVIAR SIGTERM</strong>
            </button>

            <button class="hackBtn bad" data-endpoint="/control/exit/fail" data-name="CRASH (EXIT 1)">
              <span class="tag">ALTO RISCO</span>
              <small>/control/exit/fail</small>
              <strong>CRASH (EXIT 1)</strong>
            </button>

            <button class="hackBtn bad" data-endpoint="/control/exit/success" data-name="GRACEFUL (EXIT 0)">
              <span class="tag">ALTO RISCO</span>
              <small>/control/exit/success</small>
              <strong>GRACEFUL (EXIT 0)</strong>
            </button>

            <button class="hackBtn" data-endpoint="/api/env" data-name="DUMP ENV">
              <span class="tag">INFO</span>
              <small>/api/env</small>
              <strong>DUMP ENV</strong>
            </button>
          </div>

          <div class="footer">
            <span class="kbd">Clique</span> para executar
            <span class="kbd">SHIFT</span> + clique = repetir
            <span class="kbd">?</span> abre o manual
            <span class="kbd">ESC</span> fecha
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHeader">
          <h2>Console & Status</h2>
        </div>
        <div class="panelBody">
          <div class="statusBox">
            <div class="kv"><b>Host</b><span id="host">...</span></div>
            <div class="kv"><b>Uptime</b><span id="uptime">...</span></div>
            <div class="kv"><b>Load</b><span id="load">...</span></div>
            <div class="kv"><b>Process RSS</b><span id="rss">...</span></div>
            <div class="kv"><b>Jobs</b><span id="jobs">...</span></div>
          </div>

          <div style="height:12px"></div>

          <div class="console" id="console"></div>
          <div class="hint">
            Dica: configure <span class="kbd">OPERATOR_TOKEN</span> para proteger os endpoints e <span class="kbd">SAFE_MODE</span> para limitar impacto.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DO MANUAL -->
  <div class="modalBackdrop" id="manualBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Manual de botões">
      <div class="modalHeader">
        <h3>Manual de Botões</h3>
        <div class="right">
          <span class="kbd">ESC</span> fechar
          <button class="closeBtn" id="manualCloseBtn">Fechar</button>
        </div>
      </div>
      <div class="modalBody">
        <p class="helpIntro">
          Este painel descreve o que cada botão faz. Use em ambiente de laboratório. Algumas ações podem derrubar o processo, causar OOM, lotar disco ou degradar probes.
        </p>

        <div class="helpGrid" id="helpGrid"></div>

        <div class="helpTips">
          <b>Boas práticas:</b>
          <br />• Ative <span class="kbd">OPERATOR_TOKEN</span> para evitar cliques acidentais.
          <br />• Mantenha <span class="kbd">SAFE_MODE=true</span> quando estiver testando HPA, probes e comportamento de shutdown.
          <br />• Use limites/requests no Deployment para observar OOMKill, throttling e autoscaling.
        </div>
      </div>
    </div>
  </div>

  <script>
    const consoleEl = document.getElementById('console');
    const hostEl = document.getElementById('host');
    const uptimeEl = document.getElementById('uptime');
    const loadEl = document.getElementById('load');
    const rssEl = document.getElementById('rss');
    const jobsEl = document.getElementById('jobs');
    const modeTextEl = document.getElementById('modeText');

    const manualBackdrop = document.getElementById('manualBackdrop');
    const manualOpenBtn = document.getElementById('manualOpenBtn');
    const manualCloseBtn = document.getElementById('manualCloseBtn');
    const helpGrid = document.getElementById('helpGrid');

    let clickBurst = 0;

    const helpData = [
      {
        name: 'CPU SURGE',
        endpoint: '/attack/cpu',
        risk: 'warn',
        desc: 'Gera carga intensa de CPU por alguns segundos. Útil para testar throttling, HPA e comportamento sob saturação.'
      },
      {
        name: 'RAM FLOOD',
        endpoint: '/attack/memory',
        risk: 'bad',
        desc: 'Consome memória rapidamente para testar OOMKill, limites de memória e estabilidade de nós/pods.'
      },
      {
        name: 'DISK THRASH',
        endpoint: '/attack/disk',
        risk: 'warn',
        desc: 'Escreve/gera pressão em disco. Útil para observar efeitos de disco cheio, latência e comportamento de volumes.'
      },
      {
        name: 'IO STORM',
        endpoint: '/attack/io',
        risk: 'warn',
        desc: 'Gera carga de I/O (leitura/escrita) para simular degradação. Ajuda a testar timeouts, backpressure e resiliência.'
      },
      {
        name: 'FORK SWARM',
        endpoint: '/attack/fork',
        risk: 'bad',
        desc: 'Cria muitos processos/threads em curto período. Pode degradar seriamente o container/node. Use com extremo cuidado.'
      },
      {
        name: 'NETWORK SPIKE',
        endpoint: '/attack/net',
        risk: 'warn',
        desc: 'Dispara burst de requests/saídas de rede (simulado). Bom para testar limites, latência e comportamento do app sob pico.'
      },
      {
        name: 'MARCAR DOENTE',
        endpoint: '/control/unhealth',
        risk: 'warn',
        desc: 'Força liveness/health a falhar. Útil para treinar reinício automático e políticas de recuperação.'
      },
      {
        name: 'RECUPERAR HEALTH',
        endpoint: '/control/health',
        risk: 'info',
        desc: 'Restaura o estado saudável do health/liveness para que probes voltem a passar.'
      },
      {
        name: 'FORÇAR UNREADY',
        endpoint: '/control/unreadyfor',
        risk: 'warn',
        desc: 'Marca readiness como false por um período. Simula “tirar do serviço” sem matar o pod (treino de degradação controlada).'
      },
      {
        name: 'RECUPERAR READY',
        endpoint: '/control/ready',
        risk: 'info',
        desc: 'Restaura readiness para true, permitindo que o pod volte a receber tráfego.'
      },
      {
        name: 'ENVIAR SIGTERM',
        endpoint: '/control/sigterm',
        risk: 'bad',
        desc: 'Envia SIGTERM para o processo (desligamento gracioso). Ideal para testar preStop, terminationGracePeriod e shutdown hooks.'
      },
      {
        name: 'CRASH (EXIT 1)',
        endpoint: '/control/exit/fail',
        risk: 'bad',
        desc: 'Finaliza o processo com exit code 1 (falha). Deve provocar restart de acordo com a política do pod.'
      },
      {
        name: 'GRACEFUL (EXIT 0)',
        endpoint: '/control/exit/success',
        risk: 'bad',
        desc: 'Finaliza o processo com exit code 0 (sucesso). Também encerra o pod e permite estudar comportamento de rollout/restart.'
      },
      {
        name: 'DUMP ENV',
        endpoint: '/api/env',
        risk: 'info',
        desc: 'Mostra variáveis de ambiente e valida se os valores foram configurados. Quando falta, retorna “erro de configuração, valor não encontrado”.'
      }
    ];

    function ts() {
      const d = new Date();
      const hh = String(d.getHours()).padStart(2, '0');
      const mm = String(d.getMinutes()).padStart(2, '0');
      const ss = String(d.getSeconds()).padStart(2, '0');
      return `${hh}:${mm}:${ss}`;
    }

    function addLine(msg, cls = 'ok') {
      const p = document.createElement('p');
      p.className = `line ${cls}`;
      p.innerHTML = `<span class="t">[${ts()}]</span> ${msg}`;
      consoleEl.appendChild(p);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    async function hit(endpoint) {
      try {
        addLine(`executando <span class="line code">${endpoint}</span> ...`, 'code');
        const res = await fetch(endpoint, { method: 'POST' });
        const txt = await res.text();
        if (!res.ok) {
          addLine(`falha (${res.status}): ${txt}`, 'bad');
          return;
        }
        addLine(`ok: ${txt}`, 'ok');
      } catch (e) {
        addLine(`erro: ${String(e)}`, 'bad');
      } finally {
        await refreshStatus();
      }
    }

    function wireButtons() {
      const btns = Array.from(document.querySelectorAll('button[data-endpoint]'));
      btns.forEach((btn) => {
        btn.addEventListener('click', async (ev) => {
          const endpoint = btn.getAttribute('data-endpoint');
          if (!endpoint) return;

          // SHIFT+click = burst
          if (ev.shiftKey) {
            clickBurst++;
            addLine(`burst mode x${clickBurst} :: ${endpoint}`, 'warn');
            for (let i = 0; i < clickBurst; i++) {
              await hit(endpoint);
              await new Promise(r => setTimeout(r, 180));
            }
            return;
          }

          clickBurst = 0;
          await hit(endpoint);
        });
      });
    }

    function openManual() {
      manualBackdrop.classList.add('open');
      manualBackdrop.setAttribute('aria-hidden', 'false');
    }

    function closeManual() {
      manualBackdrop.classList.remove('open');
      manualBackdrop.setAttribute('aria-hidden', 'true');
    }

    function buildHelpCards() {
      helpGrid.innerHTML = '';
      helpData.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'helpCard';

        const riskMap = {
          info: 'INFO',
          warn: 'CUIDADO',
          bad: 'ALTO RISCO'
        };

        card.innerHTML = `
          <div class="row1">
            <div class="name">${item.name}</div>
            <div class="risk ${item.risk}">${riskMap[item.risk] || 'INFO'}</div>
          </div>
          <div class="endpoint">${item.endpoint}</div>
          <div class="desc">${item.desc}</div>
        `;

        helpGrid.appendChild(card);
      });
    }

    async function refreshStatus() {
      try {
        const res = await fetch('/api/status');
        const data = await res.json();

        hostEl.textContent = data?.host || 'n/a';
        uptimeEl.textContent = data?.uptime || 'n/a';
        loadEl.textContent = data?.loadavg || 'n/a';
        rssEl.textContent = data?.rss || 'n/a';
        jobsEl.textContent = (data?.jobs != null) ? String(data.jobs) : 'n/a';

        // detecta SAFE_MODE pela string retornada se existir
        const mode = (data?.mode || '').toUpperCase();
        if (mode.includes('UNSAFE')) modeTextEl.textContent = 'UNSAFE';
        else modeTextEl.textContent = 'SAFE';

      } catch (e) {
        hostEl.textContent = 'offline';
        uptimeEl.textContent = 'n/a';
        loadEl.textContent = 'n/a';
        rssEl.textContent = 'n/a';
        jobsEl.textContent = 'n/a';
      }
    }

    function wireManual() {
      manualOpenBtn.addEventListener('click', () => openManual());
      manualCloseBtn.addEventListener('click', () => closeManual());

      manualBackdrop.addEventListener('click', (ev) => {
        if (ev.target === manualBackdrop) closeManual();
      });

      document.addEventListener('keydown', (ev) => {
        if (ev.key === '?') openManual();
        if (ev.key === 'Escape') closeManual();
      });
    }

    function boot() {
      addLine('console inicializado. pronto para simulações.', 'ok');
      buildHelpCards();
      wireButtons();
      wireManual();
      refreshStatus();
      setInterval(refreshStatus, 1800);
    }

    boot();
  </script>
</body>

</html>
